{"version":3,"sources":["gully.js"],"names":[],"mappings":"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","file":"gully.js","sourcesContent":["\n/**\n * Gully.js\n * License: MIT\n */\n\nexport default class Gully {\n\n\tconstructor(options = { hashBangs: true, viewAttribute: 'data-gully-view', notFoundUrl: \"404\" }) {\n\n\t\tthis._routes = new Set();\n\t\tthis._hashBangs = options.hashBangs;\n\t\tthis._viewAttribute = options.viewAttribute;\n\t\tthis._notFoundUrl = options.notFoundUrl;\n\t\tthis.registerEvents(this._hashBangs);\n\t}\n\n\tstate(route = null) {\n\n\t\tif (route !== null){\n\t\t\tthis._routes.add(route);\n\t\t} else {\n\t\t\tthrow (new Error('Cannot add empty state'));\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tinit() {\n\t\tthis._handle();\n\t}\n\n\tregisterEvents(hb = true) {\n\n\t\tif(hb === true) {\n\n\t\t\twindow.addEventListener('hashchange', () => {\n\t\t\t\tthis._handle();\n\t\t\t});\n\t\t}\n\t}\n\n\t_handle() {\n\n\n\t\tlet fragment = this.getUrlFragment();\n\t\tlet frags = fragment.split(/\\//).filter(Boolean);\n\t\tfrags = frags.length === 0 ? ['/'] : frags;\n\n\t\tfor(let route of this._routes) {\n\n\t\t\tlet url = route.url.split(/\\//).filter(Boolean);\n\t\t\turl = url.length === 0 ? ['/'] : url;\n\n\t\t\tif(url.length !== frags.length) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet matched = this._matchRoute(url, frags);\n\n\t\t\tif(! matched) {\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tthis.applyState(route, matched); // matched = route parameters\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._handleNotFoundUrl();\n\t}\n\n\t_matchRoute(route, frags) {\n\n\t\tlet params = new Map();\n\t\tfor(let i = 0; i < frags.length; i++) {\n\n\t\t\tlet isParam = route[i].match(/^:.+/) ? route[i].match(/^:.+/)[0] : false;\n\n\t\t\tif(isParam) {\n\n\t\t\t\tparams.set(isParam.substr(1), frags[i]);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(route[i].trim() !== frags[i].trim()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tapplyState(route, params) {\n\n\t\tthis._callController(route);\n\t\tthis._renderTemplates(route);\n\t}\n\n\t_callController(route) {\n\n\t\tif(route.controller) {\n\t\t\troute.controller(params);\n\t\t}\n\t}\n\n\t_renderTemplates(route) {\n\n\t\tlet viewElement = this._selectElement();\n\n\t\tif(route.template !== undefined) {\n\t\t\tviewElement.innerHTML = route.template;\n\t\t} else if(route.templateUrl !== undefined) {\n\n\t\t\tfetch(route.templateUrl)\n\t\t\t\t.then(function(response) {\n\t\t\t\t\treturn response.text();\n\t\t\t\t}).then(function(body) {\n\t\t\t\t\tviewElement.innerHTML = body;\n\t\t\t\t});\n\t\t}\n\t}\n\n\t_handleNotFoundUrl() {\n\n\t\tlet url = window.location.href;\n\t\turl = url.replace(/#(.*)$/, '#/' + this._notFoundUrl);\n\t\twindow.location = url;\n\t}\n\n\t_selectElement() {\n\n\t\tif(document.querySelector) {\n\t\t\treturn document.querySelector('[' + this._viewAttribute + ']');\n\t\t} else {\n\t\t\tlet allElements = document.getElementsByTagName('*');\n\t\t\tfor (let elt of allElements) {\n\t\t\t\tif (elt.getAttribute(this._viewAttribute) !== null) {\n\t\t\t\t\tmatchingElement = allElements[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn matchingElement;\n\n\t\t}\n\t}\n\n\tgetUrlFragment() {\n\n\t\tlet match = window.location.href.match(/\\/#\\/(.*)/);\t\t\n        return match ? match[1] : '';\n\t}\n\n}\n"],"sourceRoot":"/source/"}