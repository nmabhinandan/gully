{"version":3,"sources":["gully.js"],"names":[],"mappings":";;;;;;;;;;;IAKqB,KAAK;AAEd,UAFS,KAAK,GAEwE;MAArF,OAAO,gCAAG,EAAE,SAAS,EAAE,IAAI,EAAE,aAAa,EAAE,iBAAiB,EAAE,WAAW,EAAE,KAAK,EAAE;;wBAF3E,KAAK;;AAIxB,MAAI,CAAC,OAAO,GAAG,IAAI,GAAG,EAAE,CAAC;AACzB,MAAI,CAAC,UAAU,GAAG,OAAO,CAAC,SAAS,CAAC;AACpC,MAAI,CAAC,cAAc,GAAG,OAAO,CAAC,aAAa,CAAC;AAC5C,MAAI,CAAC,YAAY,GAAG,OAAO,CAAC,WAAW,CAAC;;AAExC,MAAI,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;EACrC;;cAVmB,KAAK;;SAYpB,iBAAe;OAAd,KAAK,gCAAG,IAAI;;AACjB,OAAI,KAAK,IAAI,IAAI,EAAC;AACjB,QAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IACxB,MAAM;AACN,UAAO,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAE;IAC5C;AACD,UAAO,IAAI,CAAC;GACZ;;;SAEG,gBAAG;AACN,OAAI,CAAC,OAAO,EAAE,CAAC;GACf;;;SAEa,0BAAY;;;OAAX,EAAE,gCAAG,IAAI;;AAEvB,OAAG,EAAE,KAAK,IAAI,EAAE;AACf,UAAM,CAAC,gBAAgB,CAAC,YAAY,EAAE,YAAM;AAC3C,WAAK,MAAM,EAAE,CAAC;KACd,CAAC,CAAC;IACH;GACD;;;SAEM,mBAAG;;AAET,OAAI,QAAQ,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;AACrC,OAAI,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AACjD,QAAK,GAAG,KAAK,CAAC,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;;;;;;;AAE3C,yBAAiB,IAAI,CAAC,OAAO,8HAAE;SAAvB,KAAK;;AACZ,SAAI,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AAChD,QAAG,GAAG,GAAG,CAAC,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;;AAErC,SAAG,GAAG,CAAC,MAAM,KAAK,KAAK,CAAC,MAAM,EAAE;AAC/B,eAAS;MACT;;AAED,SAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;AAC1C,YAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AACrB,SAAG,CAAE,OAAO,EAAE;AACb,eAAS;MACT,MAAM;AACN,UAAI,CAAC,UAAU,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;AAChC,aAAO;MACP;KACD;;;;;;;;;;;;;;;;AAED,OAAI,CAAC,iBAAiB,EAAE,CAAC;GACzB;;;SAES,oBAAC,KAAK,EAAE,KAAK,EAAE;AACxB,OAAI,MAAM,GAAG,IAAI,GAAG,EAAE,CAAC;AACvB,QAAI,IAAI,EAAC,GAAG,CAAC,EAAE,EAAC,GAAG,KAAK,CAAC,MAAM,EAAE,EAAC,EAAE,EAAE;AACrC,QAAI,OAAO,GAAG,KAAK,CAAC,EAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,EAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC;;AAEzE,QAAG,OAAO,EAAE;AACX,WAAM,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,EAAC,CAAC,CAAC,CAAC;AACxC,cAAS;KACT;;AAED,QAAG,KAAK,CAAC,EAAC,CAAC,CAAC,IAAI,EAAE,KAAK,KAAK,CAAC,EAAC,CAAC,CAAC,IAAI,EAAE,EAAE;AACvC,YAAO,KAAK,CAAC;KACb;IAED;AACD,UAAO,MAAM,CAAC;GACd;;;SAES,oBAAC,KAAK,EAAE,MAAM,EAAE;;AAEzB,OAAG,KAAK,CAAC,UAAU,EAAE;AACpB,SAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;IACzB;;AAED,OAAI,WAAW,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;;AAEvC,QAAK,CAAC,KAAK,CAAC,WAAW,CAAC,CACtB,IAAI,CAAC,UAAS,QAAQ,EAAE;AACxB,WAAO,QAAQ,CAAC,IAAI,EAAE,CAAA;IACtB,CAAC,CAAC,IAAI,CAAC,UAAS,IAAI,EAAE;AACtB,eAAW,CAAC,SAAS,GAAG,IAAI,CAAA;IAC5B,CAAC,CAAC;GAEJ;;;SAEgB,6BAAG;AACnB,OAAI,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC;AAC/B,MAAG,GAAG,GAAG,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC;AACtD,SAAM,CAAC,QAAQ,GAAG,GAAG,CAAC;GACtB;;;SAEY,yBAAG;;AAEf,OAAG,QAAQ,CAAC,aAAa,EAAE;AAC1B,WAAO,QAAQ,CAAC,aAAa,CAAC,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,GAAG,CAAC,CAAC;IAC/D,MAAM;AACN,QAAI,eAAe,GAAG,SAAS,CAAC;AAChC,QAAI,WAAW,GAAG,QAAQ,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;;;;;;AACrD,2BAAgB,WAAW,mIAAE;UAApB,GAAG;;AACX,UAAI,GAAG,CAAC,YAAY,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,IAAI,EAAE;AACnD,sBAAe,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;AACjC,aAAM;OACN;MACD;;;;;;;;;;;;;;;;AACD,WAAO,eAAe,CAAC;IACvB;GACD;;;SAEa,0BAAG;AAChB,OAAI,KAAK,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;AAC9C,UAAO,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;GACnC;;;QA1HmB,KAAK","file":"gully.js","sourcesContent":["/**\n * Gully.js\n * License: MIT\n */\n\nexport default class Gully {\n\n\tconstructor(options = { hashBangs: true, viewAttribute: 'data-gully-view', notFoundUrl: \"404\" }) {\n\n\t\tthis._routes = new Set();\n\t\tthis._hashBangs = options.hashBangs;\n\t\tthis._viewAttribute = options.viewAttribute;\n\t\tthis._notFoundUrl = options.notFoundUrl;\n\t\t\n\t\tthis.registerEvents(this._hashBangs);\n\t}\n\n\tstate(route = null) {\t\t\n\t\tif (route != null){\n\t\t\tthis._routes.add(route);\t\t\t\n\t\t} else {\n\t\t\tthrow (new Error('Cannot add empty state'));\n\t\t}\n\t\treturn this;\n\t}\n\n\tinit() {\n\t\tthis._handle();\n\t}\n\t\n\tregisterEvents(hb = true) {\n\n\t\tif(hb === true) {\t\t\t\n\t\t\twindow.addEventListener('hashchange', () => {\n\t\t\t\tthis.handle();\n\t\t\t});\n\t\t}\n\t}\n\n\t_handle() {\t\t\n\n\t\tlet fragment = this.getUrlFragment();\n\t\tlet frags = fragment.split(/\\//).filter(Boolean);\n\t\tfrags = frags.length === 0 ? ['/'] : frags;\n\n\t\tfor(let route of this._routes) {\n\t\t\tlet url = route.url.split(/\\//).filter(Boolean);\t\t\t\n\t\t\turl = url.length === 0 ? ['/'] : url;\n\t\t\t\n\t\t\tif(url.length !== frags.length) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet matched = this.matchRoute(url, frags);\n\t\t\tconsole.log(matched);\n\t\t\tif(! matched) {\t\t\t\t\n\t\t\t\tcontinue;\n\t\t\t} else {\t\t\t\t\n\t\t\t\tthis.applyState(route, matched);\t\t\t\t\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.handleNotFoundUrl();\n\t}\n\n\tmatchRoute(route, frags) {\n\t\tlet params = new Map();\n\t\tfor(let i = 0; i < frags.length; i++) {\n\t\t\tlet isParam = route[i].match(/^:.+/) ? route[i].match(/^:.+/)[0] : false;\n\n\t\t\tif(isParam) {\n\t\t\t\tparams.set(isParam.substr(1), frags[i]);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(route[i].trim() !== frags[i].trim()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\t\treturn params;\n\t}\n\n\tapplyState(route, params) {\t\t\n\t\t\n\t\tif(route.controller) {\n\t\t\troute.controller(params);\n\t\t}\n\t\t\n\t\tlet viewElement = this.selectElement();\n\t\t\n\t\tfetch(route.templateUrl)\n\t\t\t.then(function(response) {\t\t\t\t\n\t\t\t\treturn response.text()\n\t\t\t}).then(function(body) {\t\t\t\t\n\t\t\t\tviewElement.innerHTML = body\n\t\t\t});\n\t\t\n\t}\n\n\thandleNotFoundUrl() {\n\t\tlet url = window.location.href;\n\t\turl = url.replace(/#(.*)$/, '#/' + this._notFoundUrl);\n\t\twindow.location = url;\n\t}\n\n\tselectElement() {\n\n\t\tif(document.querySelector) {\t\t\t\n\t\t\treturn document.querySelector('[' + this._viewAttribute + ']');\n\t\t} else {\n\t\t\tlet matchingElement = undefined;\n\t\t\tlet allElements = document.getElementsByTagName('*');\n\t\t\tfor (let elt of allElements) {\n\t\t\t\tif (elt.getAttribute(this._viewAttribute) !== null) {\n\t\t\t\t\tmatchingElement = allElements[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn matchingElement;\n\t\t}\n\t}\n\n\tgetUrlFragment() {\t\t\n\t\tlet match = window.location.href.match(/\\/#\\/(.*)/);\t\t\t\t\n        return match ? match[1] : '';\n\t}\n\t\t\n}"],"sourceRoot":"/source/"}