{"version":3,"sources":["gully.js"],"names":[],"mappings":"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","file":"gully.js","sourcesContent":["/**\n * Gully.js\n * License: MIT\n */\n\nexport default class Gully {\n\n\tconstructor(options = { hashBangs: true, viewAttribute: 'data-gully-view', notFoundUrl: \"404\" }) {\n\n\t\tthis._routes = new Set();\n\t\tthis.hashBangs = options.hashBangs;\n\t\tthis.viewAttribute = options.viewAttribute;\n\t\tthis.notFoundUrl = options.notFoundUrl;\n\t\t\n\t\tthis.registerEvents(this.hashBangs);\n\t}\n\n\tstate(route = null) {\t\t\n\t\tif (route != null){\n\t\t\tthis._routes.add(route);\t\t\t\n\t\t} else {\n\t\t\tthrow (new Error('Cannot add empty state'));\n\t\t}\n\t\treturn this;\n\t}\n\n\tinit() {\n\t\tthis.handle();\n\t}\n\t\n\tregisterEvents(hb = true) {\n\n\t\tif(hb === true) {\t\t\t\n\t\t\twindow.addEventListener('hashchange', () => {\n\t\t\t\tthis.handle();\n\t\t\t});\n\t\t}\n\t}\n\n\thandle() {\t\t\n\n\t\tlet fragment = this.getUrlFragment();\n\t\tlet frags = fragment.split(/\\//).filter(Boolean);\n\t\tfrags = frags.length === 0 ? ['/'] : frags;\n\n\t\tfor(let route of this._routes) {\n\t\t\tlet url = route.url.split(/\\//).filter(Boolean);\t\t\t\n\t\t\turl = url.length === 0 ? ['/'] : url;\n\t\t\t\n\t\t\tif(url.length !== frags.length) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet matched = this.matchRoute(url, frags);\n\t\t\tconsole.log(matched);\n\t\t\tif(! matched) {\t\t\t\t\n\t\t\t\tcontinue;\n\t\t\t} else {\t\t\t\t\n\t\t\t\tthis.applyState(route, matched);\t\t\t\t\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t\n\t\tthis.handleNotFoundUrl();\n\t}\n\n\tmatchRoute(route, frags) {\n\t\tlet params = new Map();\n\t\tfor(let i = 0; i < frags.length; i++) {\n\t\t\tlet isParam = route[i].match(/^:.+/) ? route[i].match(/^:.+/)[0] : false;\n\n\t\t\tif(isParam) {\n\t\t\t\tparams.set(isParam.substr(1), frags[i]);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif(route[i].trim() !== frags[i].trim()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\t\treturn params;\n\t}\n\n\tapplyState(route, params) {\t\t\n\t\t\n\t\tif(route.controller) {\n\t\t\troute.controller(params);\n\t\t}\n\t\t\n\t\tlet viewElement = this.selectElement();\n\t\t\n\t\tfetch(route.templateUrl)\n\t\t\t.then(function(response) {\t\t\t\t\n\t\t\t\treturn response.text()\n\t\t\t}).then(function(body) {\t\t\t\t\n\t\t\t\tviewElement.innerHTML = body\n\t\t\t});\n\t\t\n\t}\n\n\thandleNotFoundUrl() {\n\t\tlet url = window.location.href;\n\t\turl = url.replace(/#(.*)$/, '#/' + this.notFoundUrl);\n\t\twindow.location = url;\n\t}\n\n\tselectElement() {\n\n\t\tif(document.querySelector) {\t\t\t\n\t\t\treturn document.querySelector('[' + this.viewAttribute + ']');\n\t\t} else {\n\t\t\tlet matchingElement = undefined;\n\t\t\tlet allElements = document.getElementsByTagName('*');\n\t\t\tfor (let elt of allElements) {\n\t\t\t\tif (elt.getAttribute(this.viewAttribute) !== null) {\n\t\t\t\t\tmatchingElement = allElements[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn matchingElement;\n\t\t}\n\t}\n\n\tgetUrlFragment() {\t\t\n\t\tlet match = window.location.href.match(/\\/#\\/(.*)/);\t\t\t\t\n        return match ? match[1] : '';\n\t}\n\t\t\n}"],"sourceRoot":"/source/"}